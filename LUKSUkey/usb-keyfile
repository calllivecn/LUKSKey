#!/bin/sh
# --> /etc/initramfs-tools/hooks/usb-keyfile

PREREQ=""

prereqs() {
    echo "$PREREQ"
}

case "$1" in
    prereqs)
        prereqs
        exit 0
        ;;
esac

. /usr/share/initramfs-tools/hook-functions

# 复制必要命令
copy_exec /sbin/blkid /sbin/blkid
copy_exec /bin/mount /bin/mount
copy_exec /bin/umount /bin/umount
copy_exec /bin/cat /bin/cat
copy_exec /bin/sleep /bin/sleep

# 复制依赖库（通常 busybox 已包含，但保险起见）
for bin in /sbin/blkid /bin/mount; do
    for lib in $(ldd "$bin" 2>/dev/null | awk '/=>/ && !/not found/ {print $3}'); do
        [ -e "$lib" ] && copy_exec "$lib"
    done
done

